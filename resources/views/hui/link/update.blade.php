@extends('hui_layouts.appuiupdate')@section('title', $title)@section('here')@endsection@section('addcss')    @parent@endsection@section('addjs')    @parent@endsection@section("mainbody")    @parent@endsection@section('formbody')    <div class="layui-form-item">        <label class="layui-form-label col-sm-1">名称</label>        <div class="col-sm-11">            <input type="text" name="name" lay-verify="required" required placeholder="名称" autocomplete="off" class="layui-input" value="{{ $edit->name }}">        </div>    </div>    <div class="layui-form-item">        <label class="layui-form-label col-sm-1">图片</label>        <div class="col-sm-11">            <input type="file" name="thumb" lay-type="image" lay-ext="png|jpg" class="layui-upload-file">            <br/>            <input type="hidden" name="thumb_url"  class="thumb" value="{{$edit->thumb_url}}">            <span class="imgshow">@if($edit->thumb_url!='')<img src="{{$edit->thumb_url}}" width="100" style="float:left;"/>@endif</span>            <script>                layui.use('upload', function(){                    layui.upload({                        url: '{{route("uploads_uploadclassifyimgage")}}?_token={{ csrf_token() }}'                        ,success: function(src){                            console.log(src);                            if(src.status==0){                                layer.msg(src.msg,{time:500},function(){                                    $(".imgshow").html('<img src="'+src.src+'?t='+new Date()+'" width="100" style="float:left;"/>');                                    $(".thumb").val(src.src);                                });                            }                        }                    });                });            </script>        </div>    </div>    <div class="layui-form-item">        <label class="layui-form-label col-sm-1">链接地址</label>        <div class="col-sm-11">            <input type="text" name="url" lay-verify="required" autocomplete="" class="layui-input" placeholder="链接地址 http://www.baidu.com" value="{{ $edit->url }}">        </div>    </div>    <div class="layui-form-item">        <label class="layui-form-label col-sm-1">背景颜色</label>        <div class="col-sm-11">            <input type="tel" name="color" lay-verify="" autocomplete="" class="layui-input" placeholder="背景颜色" value="{{ $edit->color }}">        </div>    </div>    <div class="layui-form-item">        <label class="layui-form-label col-sm-1">排序</label>        <div class="col-sm-11">            <input type="tel" name="sort" lay-verify="required|number" autocomplete="" class="layui-input" placeholder="排序" value="{{ $edit->sort }}">        </div>    </div>@endsection@section("layermsg")    @parent@endsection@section('form')    <script>        var s_classify='{{$edit->parent}}';        layui.use('form', function(){            var form = layui.form();            //各种基于事件的操作，下面会有进一步介绍            //自定义验证规则            form.verify({            });            //监听提交            form.on('submit(go)', function(data){                return true;            });            form.on('select(s_storeid)', function(data){              //  getdatas(data.value);            });            var storeid =$("[name='storeid']").val();            if(storeid>0){              //  getdatas(storeid);            }            function  getdatas(storeid){                var index;                $.ajax({                    url: "{{ route('product_getclassify') }}",                    type:"post",     //请求类型                    data:{  storeid:storeid, _token:"{{ csrf_token() }}"                    },  //请求的数据                    dataType:"json",  //数据类型                    beforeSend: function () {                        // 禁用按钮防止重复提交，发送前响应                        index = layer.load();                    },                    success: function(data){                        //laravel返回的数据是不经过这里的                        if(data.status==0){                            var classify=data.list;                            if(classify.length){                                set_html(classify);                            }else{                                $(".s_classify").html('');                            }                        }else{                            layer.msg(data.msg,{icon: 5},function(){                            });                        }                    },                    complete: function () {//完成响应                        // layer.closeAll();                        layer.close(index);                    },                    error: function(msg) {                        var json=JSON.parse(msg.responseText);                        var errormsg='';                        $.each(json,function(i,v){                            errormsg+=' <br/>'+ v.toString();                        } );                        layer.alert(errormsg);                    },                });            }            var classify_html='';            function set_html(classify,index_i=0){                if(index_i==0){                    classify_html='';                }                var listkeys='';                for(var ki=0;ki<index_i;ki++){                    listkeys+='┕';                }                for(var i in classify){                    if(s_classify==classify[i].id){                        var selected=' selected="selected"';                    }else{                        var selected='';                    }                    classify_html+='<option value="'+classify[i].id+'" '+selected+'>'+listkeys+classify[i].name+'</option>';                    if(classify[i].parents.length>0){                        index_i++;                        set_html(classify[i].parents,index_i);                    }                }                $(".s_classify").html(classify_html);                form.render(); //更新全部            }        });    </script>    @endsection